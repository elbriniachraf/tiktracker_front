<div class="product-list-container immersive-design">
  <!-- Barre d'outils -->

  <style>
    /* Barre d'outils */
.toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  background: #f8f9fa;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);
}

/* Champ de recherche */
.search-input {
  flex: 1;
  padding: 10px 15px;
  border: 2px solid #28a745;
  border-radius: 8px;
  font-size: 1rem;
  outline: none;
  transition: 0.3s;
}

.search-input:focus {
  border-color: #218838;
  box-shadow: 0px 0px 10px rgba(40, 167, 69, 0.3);
}

/* Conteneur des boutons */
.actions {
  display: flex;
  gap: 10px;
}

/* Boutons */
.btn {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: bold;
  border: none;
  padding: 10px 15px;
  border-radius: 8px;
  font-size: 1rem;
  cursor: pointer;
  transition: 0.3s ease-in-out;
}

/* Bouton Ajouter */
.btn-add {
  background: #28a745 !important;
  color: #fff !important;
}

.btn-add:hover {
  background: #218838 !important;
}

/* Bouton Cat√©gories */
.btn-categories {
  background: #17a2b8 !important;
  color: #fff !important;
}

.btn-categories:hover {
  background: #138496 !important;
}

/* Bouton TVA */
.btn-tva {
  background: #ffc107 !important;
  color: #212529 !important;
}

.btn-tva:hover {
  background: #e0a800 !important;
}

/* Ic√¥nes */
.btn fa-icon {
  font-size: 1.2rem;
}

    .drawer-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 999;
}

.drawerr {
  position: fixed;
  right: -350px;
  top: 0;
  width: 300px;
  height: 100%;
  background: #ffffff;
  box-shadow: -4px 0 10px rgba(0, 0, 0, 0.2);
  transition: right 0.3s ease-in-out;
  z-index: 1000;
  padding: 20px;
  border-radius: 10px 0 0 10px;
}

.drawerr.open {
  right: 0;
}

.drawer-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 18px;
  font-weight: bold;
  color: #28a745;
  border-bottom: 2px solid #28a745;
  padding-bottom: 10px;
}

.close-btn {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
}

.drawer-content {
  margin-top: 20px;
}

.tva-list {
  list-style: none;
  padding: 0;
}

.tva-list li {
  background: #f8f9fa;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 5px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.actions button {
  background: none;
  border: none;
  cursor: pointer;
  margin-left: 5px;
}

.edit-btn {
  color: #ffc107;
}

.delete-btn {
  color: #dc3545;
}

.btn-addd {
  background: #28a745;
  color: white;
  border: none;
  padding: 10px;
  width: 100%;
  margin-top: 10px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
}

  .drawer .category-list {
    margin-top: 20px;
    overflow-y: scroll;
    overflow-x: hidden;
    
  }
  
  .category-list h4 {
    margin-bottom: 15px;
    color: #333;
    font-size: 18px;
    font-weight: bold;
  }
  
  .category-card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #f9f9f9;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    width: 90%; /* 90% of parent width */
    margin-left: auto;
    margin-right: auto;
  }
  
  .category-card .card-icon {
    font-size: 24px;
    color: #4CAF50; /* Green color for the icon */
    margin-right: 15px;
  }
  
  .category-card .card-content {
    flex: 1;
  }
  
  .category-card .card-content h5 {
    margin: 0;
    font-size: 16px;
    color: #333;
    font-weight: bold;
  }
  
  .category-card .card-content p {
    margin: 5px 0 0;
    font-size: 14px;
    color: #666;
  }
  
  .category-card .card-actions {
    margin-left: 15px;
  }
  
  .category-card .btn-delete {
    background: #ff6f61;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 14px;
    cursor: pointer;
  }
  
  .category-card .btn-delete:hover {
    background: #e65b50;
  }
  

  /* Bouton d'extension */
.expand-button {
  display: flex;
  align-items: center;
  cursor: pointer;
  font-size: 16px;
  color: #007bff;
  margin-bottom: 15px;
}

.expand-button fa-icon {
  margin-right: 10px;
}

/* Formulaire d'ajout */
.category-form {
  background-color: #f8f9fa;
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 20px;
}

.category-form .form-group {
  margin-bottom: 15px;
}

.category-form .form-actions {
  display: flex;
  justify-content: flex-start;
}

.category-form .btn-submit {
  background-color: #28a745;
  color: white;
  padding: 10px 20px;
  border: none;
  cursor: pointer;
  border-radius: 5px;
}

.category-form .btn-submit:hover {
  background-color: #218838;
}

/* Carte des cat√©gories */
.category-card {
  display: flex;
  background-color: #ffffff;
  padding: 15px;
  margin: 10px 0;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  width: 90%;
}

.card-icon {
  font-size: 24px;
  margin-right: 20px;
}

.card-content {
  flex: 1;
}

.card-actions {
  display: flex;
  align-items: center;
  justify-content: flex-end;
}


.drawerr {
  position: fixed;
  top: 0;
  right: 0;
  width: 400px;
  height: 100%;
  background-color: #fff;
  box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease;
  transform: translateX(100%);
  z-index: 999;
}

.drawerr.open {
  transform: translateX(0);
}

.drawerr-header {
  padding: 20px;
  background-color: #4CAF50;
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.drawerr-header h3 {
  margin: 0;
}

.close-btn {
  background: none;
  border: none;
  color: white;
  font-size: 20px;
}

.drawerr-content {
  padding: 20px;
}

.tva-list {
  list-style-type: none;
  padding: 0;
}

.tva-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  border-bottom: 1px solid #ddd;
  padding-bottom: 10px;
}

.tva-name {
  font-weight: 500;
}

.actions button {
  background: none;
  border: none;
  margin-left: 10px;
}

.actions button:hover {
  color: #4CAF50;
}

.btn-addd {
  display: flex;
  align-items: center;
  background-color: #4CAF50;
  color: white;
  padding: 10px 20px;
  border: none;
  cursor: pointer;
  margin-top: 20px;
  font-size: 16px;
  width: 100%;
  justify-content: center;
}

.add-tva-form {
  background-color: #f9f9f9;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  margin-top: 20px;
}

.add-tva-form .form-group {
  margin-bottom: 15px;
}

.add-tva-form label {
  display: block;
  font-size: 14px;
  margin-bottom: 5px;
}

.add-tva-form input {
  width: 100%;
  padding: 10px;
  font-size: 14px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.form-actions .btn {
  padding: 10px 20px;
  font-size: 14px;
  cursor: pointer;
}

.btn-primary {
  background-color: #4CAF50;
  color: white;
  border: none;
}

.btn-secondary {
  background-color: #f1f1f1;
  color: #333;
  border: none;
}

.drawer-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.5);
  z-index: 998;
}


    .action-buttons {
      display: flex;
      gap: 5px;
    }
    .btn-sm {
      width: 42px;
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      padding: 15px;
    }

    
  </style>
<div class="toolbar">
  <!-- Barre de recherche -->
  <input
  type="text"
  class="search-input"
  placeholder="üîç Rechercher un produit..."
  [(ngModel)]="searchQuery"
  (input)="onSearch(searchQuery)"
/>


  <!-- Boutons d'actions -->
  <div class="actions">
    <button class="btn btn-add" (click)="ajouterProd()">
      <fa-icon [icon]="'plus'"></fa-icon> Ajouter un produit
    </button>

    <button class="btn btn-categories"  (click)="toggleDrawer()" >
      <fa-icon [icon]="'folder-open'"></fa-icon> Gestion des Cat√©gories
    </button>

    <button class="btn btn-tva" (click)="toggleDrawer2()" >
      <fa-icon [icon]="'percent'"></fa-icon> Gestion des TVA
    </button>
  </div>
</div>
<div class="drawer-overlay" *ngIf="isDrawerOpen2" (click)="toggleDrawer2()"></div>
<div class="drawerr" [class.open]="isDrawerOpen2">
  <div class="drawerr-header">
    <h3><fa-icon [icon]="'percent'"></fa-icon> Gestion des TVA</h3>
    <button class="close-btn" (click)="toggleDrawer2()">
      <fa-icon [icon]="'times'"></fa-icon>
    </button>
  </div>

  <div class="drawerr-content">
    <!-- Liste des TVA existants -->
    <ul class="tva-list">
      <li *ngFor="let tva of tvaList">
        <div class="tva-item">
          <span class="tva-name">{{ tva.nom }} - {{ tva.taux }}%</span>
          <div class="actions">
            <button class="edit-btn" (click)="editTva(tva)">
              <fa-icon [icon]="'edit'"></fa-icon>
            </button>
            <button class="delete-btn" (click)="deleteTva(tva.id)">
              <fa-icon [icon]="'trash'"></fa-icon>
            </button>
          </div>
        </div>
      </li>
    </ul>

    <!-- Ajouter une nouvelle TVA -->
    <button class="btn btn-addd" (click)="toggleForm2()">
      <fa-icon [icon]="'plus'"></fa-icon> Ajouter une TVA
    </button>

    <!-- Formulaire d'ajout TVA -->
    <div *ngIf="isFormOpen" class="add-tva-form">
      <form (ngSubmit)="addTva()">
        <div class="form-group">
          <label for="nom">Nom de la TVA</label>
          <input id="nom" name="nom" [(ngModel)]="newTva.nom" type="text" required>
        </div>
        <div class="form-group">
          <label for="taux">Taux (%)</label>
          <input id="taux" name="taux" [(ngModel)]="newTva.taux" type="number" min="0" required>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Ajouter</button>
          <button type="button" class="btn btn-secondary" (click)="toggleForm2()">Annuler</button>
        </div>
      </form>
    </div>
  </div>
</div>


<div class="drawer" [class.open]="drawerOpen">
  <div class="drawer-content">
    <div class="expand-button" (click)="toggleForm()">
      <fa-icon [icon]="['fas', 'plus-circle']"></fa-icon> Ajouter une cat√©gorie
    </div>
    <form  *ngIf="showForm" >
      <div class="form-group">
        <label for="categoryName">Nom de la cat√©gorie</label>
        <input 
          id="categoryName" 
          type="text" 
          [(ngModel)]="newCategoryName" 
          name="categoryName" 
          placeholder="Nom de la cat√©gorie" 
          required />
      </div>
      
      <div class="form-group">
        <label for="categoryDescription">Description</label>
        <textarea 
          id="categoryDescription" 
          [(ngModel)]="newCategoryDescription" 
          name="categoryDescription" 
          placeholder="Description de la cat√©gorie" 
          required></textarea>
      </div>
      
      <div class="form-actions">
        <button type="button" (click)="addCategory()" class="btn btn-submit">
          <fa-icon [icon]="['fas', 'plus']"></fa-icon> Ajouter
        </button>
        <button type="button" class="btn btn-reset" (click)="resetForm()">
          <fa-icon [icon]="['fas', 'redo']"></fa-icon> R√©initialiser
        </button>
      </div>
    </form>

    <div class="category-list">
      <h4>Liste des Cat√©gories</h4>
      
      <div class="category-card" *ngFor="let category of categories">
        <div class="card-icon">
          <fa-icon [icon]="['fas', 'folder']"></fa-icon>
        </div>
        <div *ngFor="let product of products">
          <div class="card-content">
            <h5>{{ product.category?.name }}</h5>
            <p>{{ product.category?.description }}</p>
          </div>
        </div>
        
        <div class="card-actions">
          <button class="btn btn-delete" (click)="deleteCategory(category._id)">
            <fa-icon [icon]="['fas', 'trash']"></fa-icon> Supprimer
          </button>
        </div>
      </div>
    </div>
    
    <button (click)="toggleDrawer()" class="btn btn-close-drawer">
      <fa-icon [icon]="['fas', 'times']"></fa-icon> Fermer
    </button>
  </div>
</div>


  <ngx-datatable
  class="material"
  [rows]="filteredProducts" 
  [rows]="products"
  [columnMode]="'force'"
  [headerHeight]="60"
  [footerHeight]="60"
  [rowHeight]="'auto'"
  [limit]="pageSize"
  [scrollbarH]="true"
  [sorts]="sorts"
  (sort)="onSort($event)"
  [loadingIndicator]="loading"
  style="width: 100%; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);"
>
  <!-- Num√©ro -->
  <ngx-datatable-column name="#" [sortable]="false">
    <ng-template ngx-datatable-cell-template let-row="row" let-rowIndex="rowIndex">
      <strong>{{ rowIndex + 1 }}</strong>
    </ng-template>
  </ngx-datatable-column>


  <!-- R√©f√©rence -->
  <ngx-datatable-column name="R√©f√©rence" prop="reference" [sortable]="true">
    <ng-template let-value="value">
      <strong class="price">{{ value }} MAD</strong>
    </ng-template>
  </ngx-datatable-column>
  
  <!-- Nom -->
  <ngx-datatable-column name="Nom" prop="label" [sortable]="true"></ngx-datatable-column>
  
  <!-- Description -->
  <ngx-datatable-column name="Description" >
    <ng-template ngx-datatable-cell-template let-row="row">
      <a href="javascript:void(0)" (click)="showDescription(row)" class="description-link">
        <fa-icon [icon]="'eye'"></fa-icon> Voir
      </a>
    </ng-template>
  </ngx-datatable-column>
  
  <!-- Cat√©gorie -->
  <ngx-datatable-column name="Cat√©gorie" prop="category" [sortable]="true"></ngx-datatable-column>
  
  <!-- Prix -->
  <ngx-datatable-column name="Prix" prop="selling_price" [sortable]="true">
    <ng-template let-value="value">
      <div class="price">
        <fa-icon [icon]="'money-bill-wave'"></fa-icon>
        {{ value | currency:'EUR' }} MAD
      </div>
    </ng-template>
  </ngx-datatable-column>
  
  <!-- Poids -->
  <ngx-datatable-column name="Poids" prop="weight" [sortable]="true">
    <ng-template let-value="value">
      <div class="price">
        <fa-icon [icon]="'balance-scale'"></fa-icon>
        <strong>{{ value }} kg</strong>
      </div>
    </ng-template>
  </ngx-datatable-column>
  
    
    <!-- Largeur -->
    <ngx-datatable-column name="Largeur" prop="length" [sortable]="true">
      <ng-template let-value="value">
        <div class="price">
          <fa-icon [icon]="'arrows-alt-h'"></fa-icon>
          {{ value }} cm
        </div>
      </ng-template>
    </ngx-datatable-column>
    
    <!-- Longueur -->
    <ngx-datatable-column name="Longueur" prop="width" [sortable]="true">
      <ng-template let-value="value">
        <div class="price">
          <fa-icon [icon]="'arrows-alt-v'"></fa-icon>
          {{ value }} cm
        </div>
      </ng-template>
    </ngx-datatable-column>
      <!-- Actions -->
  <ngx-datatable-column name="Actions">
    <ng-template let-row="row" ngx-datatable-cell-template>
      <div class="action-buttons">
        <button class="btn btn-info btn-sm" (click)="viewProduct(row.id)">
          <fa-icon [icon]="'eye'"></fa-icon>
        </button>        
        <button class="btn btn-warning btn-sm" [routerLink]="['/main/produits-services/edit-product', row.id]">
          <fa-icon [icon]="'edit'"></fa-icon> 
        </button>
        
        <button class="btn btn-danger btn-sm" (click)="deleteProduct(row.id)">
          <fa-icon [icon]="'trash'"></fa-icon>
        </button>
      
      </div>
    </ng-template>
  </ngx-datatable-column>

    
  </ngx-datatable>
  

  <!-- Drawer pour afficher la description -->
  <div class="drawer" [class.open]="isDrawerOpen">
    <div class="drawer-header">
      <h3>Description</h3>
      <button (click)="closeDrawer()" class="close-btn">&times;</button>
    </div>
    <div class="drawer-content" [innerHTML]="selectedDescription"></div>
  </div>

  <!-- Pagination -->
  <div class="pagination">
    <button><fa-icon [icon]="'chevron-left'"></fa-icon></button>
    <span>Page sur </span>
    <button><fa-icon [icon]="'chevron-right'"></fa-icon></button>
  </div>
</div>
 <!-- drawer -->
<div class="drawer" [class.open]="isDrawerOpen3">
  <div class="drawer-content">
    <div class="drawer-header">
      <h3>D√©tails du produit</h3>
      <button (click)="closeDrawer3()" class="close-btn">&times;</button>
    </div>

    <div *ngIf="selectedProduct">
      <p><strong>R√©f√©rence:</strong> {{ selectedProduct.reference }}</p>
      <p><strong>Libell√©:</strong> {{ selectedProduct.label }}</p>
      <p><strong>Cat√©gorie:</strong> {{ selectedProduct.category }}</p>
      <p><strong>En vente:</strong> {{ selectedProduct.is_selling ? 'Oui' : 'Non' }}</p>
      <p><strong>Achat possible:</strong> {{ selectedProduct.is_purchasing ? 'Oui' : 'Non' }}</p>
      <p><strong>Description:</strong> {{ selectedProduct.description }}</p>
      <p><strong>URL publique:</strong> <a [href]="selectedProduct.public_url" target="_blank">{{ selectedProduct.public_url }}</a></p>
      <p><strong>Type de produit:</strong> {{ selectedProduct.product_type }}</p>
      <p><strong>Poids:</strong> {{ selectedProduct.weight }} kg</p>
      <p><strong>Longueur:</strong> {{ selectedProduct.length }} cm</p>
      <p><strong>Largeur:</strong> {{ selectedProduct.width }} cm</p>
      <p><strong>Hauteur:</strong> {{ selectedProduct.height }} cm</p>
      <p><strong>Dimensions:</strong> {{ selectedProduct.dimensions }}</p>
      <p><strong>Surface:</strong> {{ selectedProduct.surface }} m¬≤</p>
      <p><strong>Volume:</strong> {{ selectedProduct.volume }} m¬≥</p>
      <p><strong>Code douanier:</strong> {{ selectedProduct.customs_code }}</p>
      <p><strong>Pays d'origine:</strong> {{ selectedProduct.country_of_origin }}</p>
      <p><strong>√âtat d'origine:</strong> {{ selectedProduct.state_of_origin }}</p>
      <p><strong>Note:</strong> {{ selectedProduct.note }}</p>
      <p><strong>Tags:</strong> {{ selectedProduct.tags }}</p>
      <p><strong>Prix de vente:</strong> {{ selectedProduct.selling_price | currency }}</p>
      <p><strong>Prix:</strong> {{ selectedProduct.price | currency }}</p>
      <p><strong>Prix de vente minimum:</strong> {{ selectedProduct.min_selling_price | currency }}</p>
      <p><strong>Taux de taxe:</strong> {{ selectedProduct.tax_rate }}%</p>
    </div>
  </div>
</div>



